# Домашнее задание к занятию "5.1. Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения."

## Задача 1

### Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.


### Решение:


- В первом случае используются узко специализированный операционные системы, гипервизоры. Они содержат только функционал необходимый для безопасного распределения ресурсов между гостевыми операционными системами, эмуляцией устройств, обеспечивают изолированность. Соответственно объем гипервизоров не велик. К примеру iso образа VMWare ESXi 6.7 около 327 Мб. Аппаратная виртуализация является типом полной, но в данном случае гостевая ОС может выполнять привилегированные команды CPU т.е. позволяет работать ВМ в нулевом кольце. 
- В случае с паравиртуализацией, в операционной системе запускается программа, которой доступны выделенные для нее ресурсы, которые она может распределять между виртуальными машинами. В реальности процесс выглядит сложнее, например KVM является модулем ядра ОС.
В любом случае ресурсами сервера управляет операционная система общего назначения. 
- В третьем варианте нет необходимости эмулировать устройства и т.д. Операционная система должна поддерживать несколько изолированных экземпляров пространства имен (namespace). В данном курсе уже были затронуты подобные механизмы - chroot, cgroups. В этом случае виртуализация так же как и в предыдущем обеспечивается за счет операционной системы общего назначения. Если в случае с паравиртуализацией можно в ОС Ubuntu с помощью KVM запустить к примеру MacOS Catalina для проведения тестов и даже получиться пробросить звук из гостевой машины, то с виртуализацией на основе ОС такой вариант пожалуй не получиться реализовать. Необходимо, чтобы ядра гостевой и хостовой ОС были одинаковыми, но при этом возможно гибкое и изолированное решение для работы микросервисов.
 
## Задача 2

### Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.

### Решение:

* Высоконагруженная база данных, чувствительная к отказу.

1. Пожалуй, лучшим вариантом будет аппаратная виртуализация, можно обеспечить высоко отказоустойчивость и масштабируемость, но в списке выбора ее нет, так что лучше реализовать на физическом сервере. Можно было бы предположить паравиртуализацию, но не получается представить скажем базу данных Oracle с бизнес логикой реализованной на PL/SQL запущенный в VirtualBox или MS SQL с виртуализацией уровня ОС.

2. Различные web-приложения можно спокойно запустить с использованием виртуализация уровня ОС. Приложения будут изолированы каждый в своем пространстве. Отказ в обслуживании одного приложения не повлечёт проблем с другими. Т.е. необходимо и достаточно.

3. Windows системы для использования бухгалтерским отделом. Пожалуй лучшим решением будет паравиртуализация Hyper-V.

4. Системы, выполняющие высокопроизводительные расчеты на GPU. Не встречал, чтобы процессорное время GPU удачно управлялось системами виртуализации, возможно просто не сталкивался. Считаю наиболее удачный вариант - физический сервер.

## Задача 3

### Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

### Решение:

* 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.

Для решения данной задачи можно было бы использовать VMWare ESXi. Прекрасно работает как с Linux так и с Windows. Так как речь не идет о бесплатном использовании, то для управления можно себе позволить vCenter и аркестратор. Есть балансировщик нагрузки, репликация данных, а вот со встроенным резервным копирования начиная с версии 6.7 возникают некоторые сложности. Продукт vSphere Data Protection больше не поддерживается и если нас не устроит в рамках данного задания использования решений других вендора или резервное копирования через скрипты, то такой вариант отпадает. Но есть Hyper-V от Microsoft в котором есть все необходимые механизмы и даже резервное копирование с помощью System Center Data Protection Manager (далее - DPM) или скриптов на базе wbadmin. С помощью DPM Не получиться выполнить сетевое резервное копирование Linux, но при этом поддерживаются моментальные снимки.

* Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.

В данном случае, пожалуй, будет выбор между решением на базе Xen и KVM. Сообщество как Xen так и KVM достаточно многочисленное, проблем с поиском решений проблем не должно возникнуть. С учетом того, что в инфраструктуре имеются сервера не только с ОС Linux но и Windows, а Xen с Windows показывает более стабильные результаты, то выбор будет за Xen.

* Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.

Если у нас уже есть лицензии на Windows и они, скорее всего серверные и начинаются с Windows Server 2008 x64 (Hyper-V включон как бетта), а в 2008 R2 то Hyper-V уже полноценно в составе, то задача решена без дополнительных затрат. Hyper-V даже есть в Windows 8 Pro/Enterrise, и т. д. 

* Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

Возникает вопрос, данные дистрибутивы имеют одинаковые ядра или нет. Как правило, если тестируется программный продукт, то он должен работать не только на разных дистрибутивах, но и на различных ядрах. В данном случае подойдет как Xen так и KVM. Так как  KVM более простое решение в развертывании и имеет так же как Xen хорошую совместимость со всеми дистрибутивами Linux, то будет более предпочтительным.

## Задача 4

### Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

### Решение:

Проблемы с администрированием. Для каждой среды виртуализации нужен свой подход, набор скриптов, возможно дополнительные программы, например для резервного копирования и т.п. В случае приема на работу персонала появляется более сложный набор требований и соответственно возникают проблемы с нахождением компромиссов между специалистом с более высокой з/п и специалистом готовым разобраться в процессе если конечно после разбирательства процесс все еще будет жив.
Если все же пришлось работать с такой средой, к примеру в организации все было построено на Hyper-V, но появилось требование импортозамещения и это необходимо учитывать во всех новых проектах и спланировать переход в имеющихся. Для минимизации рисков и проблем необходимо найти одно решение соответствующее большинству наиболее важных требований и следовать ему. В процессе внедрения следить за документированием.
Если бы у меня был выбор, и можно было не обращать внимания на стоимость железа и лицензий, то не выбрал бы гетерогенную среду. В качестве первого типа гипервизора использовал только VMware ESXi и т.д. для каждого типа гипервизора решение одно вендора.
