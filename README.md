# Домашнее задание к занятию "3.1. Работа в терминале, лекция 1"

## Какой переменной можно задать длину журнала history, и на какой строчке manual это описывается?

### Ответ:

Длина файла журнала history задается переменной HISTFILESIZE, строка 793 man bash.
Если значение переменной явно не указано, то устанавливается равной переменнйо HISTSIZE, которая описана начиная со строки 807 man bash.
Переменной HISTSIZE задается количество команд в текущей сесии bash, по умолчанию 500. 

## что делает директива ignoreboth в bash?

### Ответ:

Директива ignoreboth делает активными две другие директивы:
- ignorespace, не записывать в историю команды начинающиеся с пробела;
- ignoredups, не записывать текущую команду в историю если она совпадает с предыдущей.

## В каких сценариях использования применимы скобки {} и на какой строчке man bash это описано?

### Ответ:

В контексте данного задания {} применяются для генерации произвальных строк описанных начиная со строки 1021 man bash.

Использоваться может в сценариях при работе с файлами. Пример из man bash:

Создание 4 поддиректорий

``` bash
mkdir /home/{subdir{1,2},new,old}
```

Назначение владельца для файлов

``` bash
chown root /usr/{ucb/{ex,edit},lib/{ex?.?*,how_ex}}
```
путь к которым соответствует одному из условий /usr/ucb/ex /usr/ucb/edit /usr/lib/ex?.?* /usr/lib/how_ex, где ? - любой символ, * - любая последовательноть символов

Также может использоваться в командах chmod, rm, touch, echo и т. д.

Может быть также создана числовая или символная последовательность с определенным шагом {x..y..inc}

## С учётом ответа на предыдущий вопрос, как создать однократным вызовом touch 100000 файлов? Получится ли аналогичным образом создать 300000? Если нет, то почему?

### Ответ:

``` bash
touch {1..100000}
```

По умолчанию touch {1..300000} выполнена не будет, получим сообщение об ошибке: Argument list too long

Описание максимальной длинны списка аргумента имеется в man execve, где execve() - процедура языка C используемая для выполнения программ.

По умолчанию man execve не доступен в используемой версии ubuntu.

Установим соответствующий man:

``` bash
apt-cache search manpages | grep 'dev'

sudo apt-get install manpages-dev

man execve
```

Начиная с 159 строки описывается размер аргумента и окружения, для ядра 2.6.23 и более поздних размер аргумента и окружения ARG_MAX устанавливается равным 1/4 стека.

Получим текущее значение параметра ARG_MAX выполнив команду:

``` bash
getconf ARG_MAX
````

2097152

В man bash начиная со строки 4092 описывается команда ulimit.

Размер стека в текущей сессии по умолчанию:

``` bash
ulimit -s
```
8192 Кб

Если ARG_MAX*4 то получаем как раз 8 Мб.

Если для текущей сессии увеличить размер стека в три раза

``` bash
ulimit -s 24576
```
то команда 

``` bash
touch {1..300000} 
```

будет выполнена.

## В man bash поищите по /\[\[. Что делает конструкция [[ -d /tmp ]]

### Ответ:

Данная конструкция проверяет существует ли файл /tmp и является ли он директорией, если да, то возвращается true.

#### Пример:

``` bash
if [[ -d /tmp/ ]]; then echo "file exists and is a directory."; else echo "file don't exists."; fi
```

## Основываясь на знаниях о просмотре текущих (например, PATH) и установке новых переменных; командах, которые мы рассматривали, добейтесь в выводе type -a bash в виртуальной машине наличия первым пунктом в списке:

### Ответ:

Так как в type --help с параметром -a указано, что отображает все местоположения включая aliases, то создадим директории и в них символьные ссылки на bash.

``` bash
mkdir -p /tmp/new_path_directory/
ln -s /usr/bin/bash /tmp/new_path_directory/
ln -s /usr/bin/bash /usr/local/bin/
```

Изменим для текущей сессии значение переменной PATH. Для совместимости с другими интерпритаторами будем использовать следующий синтексис:

``` bash
export PATH="/tmp/new_path_directory:/usr/local/bin:/bin:$PATH"
```

либо для того, чтобы два раза не стречался в переменной PATH один и тот же путь:

``` bash
export PATH="/tmp/new_path_directory:/usr/local/bin:/bin:/usr/local/sbin:/usr/sbin:/usr/bin:/sbin:/usr/games:/usr/local/games:/snap/bin"
```

## Чем отличается планирование команд с помощью batch и at?

### Ответ:

at выпоняет разовое задание в указанное время, а batch выполняет задание когда средняя загруженность CPU падает ниже 1,5 или значения заданного командой atd с использованием параметра -l. Посмотреть среднюю загруженность CPU можно командой uptime.

