# Домашнее задание к занятию "6.1. Типы и структура СУБД"

## Задача 1

### Решение

* Электронные чеки в json виде

Полностью оправдано использование документо-ориентированные БД такой как СУБД MongoDB.

* Склады и автомобильные дороги для логистической компании

Для учета товаров на складах отлично подходят реляционные база данных (далее - БД).
Использование связей по ключам + транзакции позволит отслеживать товар по схеме:
адрес отправления - склад (ряд, стелаж, полка, место) - Трак - промежуточный склад (...) - ... - склад адреса назначения - получатель.
Учесть наполняемость трака по массе, заполненность склада и т.д. можно с помощью агрегатных функций.

Для учета автомобильных дорог и их характеристик интересным вариантом является графовая БД, к тому же теорема Эйлера, которая была положена в основу теории графов была сформулирована в ходе решения геоинформационной задачи. В настоящее время данные БД используются в системах навигации в том числе для постраения оптимального маршрута. Но если необходимо выбрать одну модель, то вполне подойдет реляционная БД. С учетом того, что груз после доставки не участвует в транзакциях, можно создать оперативный набор таблиц и архивный, таким образом решить проблему замедления производительности при увеличении объема данных. Такой встроеный функционал в СУБД как тригеры, хранимые процедуры, представления, оптимизатор запросов, кэш, и т. д. позволяет реализовать всю бизнес логику на стороне сервера особенно если это СУБД Oracle.

* Генеалогические деревья

Для данного случая иерархическая база не подойдет, так как каждая дочерняя запись имеет только одного родителя.
Пожалуй оптимальным вариантом является графовая БД, к том же в области социальных связей уже используется (социальные сети). Позволяет учитывать как дискретную информацию об индивидуме, так и связи с другими. В любом случае, если заказчик планирует построить генеалогическое древо от Адама и Евы, ну или по Ч. Дарвину от других предков, то выбор СУБД не будет иметь никакого значения.

* Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации

Требования к данной БД минимальные. Такие механизмы как связи, тригеры, контроль целостности не нужны. Необходимо, чтобы БД работала как можно быстрее, был механизм времени жизни записи (Time-To-Live) и как правило при аутентификации обычно используется хеш функций. Для данных целей подойдет БД вида "ключ - значение", к примеру СУБД Redis. Если хэш функции не нужны или есть возможность реализации в приложении, то вполне подойдет СУБД Memcached.

* Отношения клиент-покупка для интернет-магазина

Если классичечкий интрернет-магазин, клиент зашел - нашел - купил - забыл, то подойдет реляционная база данных. Если необходим сложный поиск с подбором сопутствующих товаров, "предложений дня" исходя из классификаиции ранее преобретенных товаров или товаров в данный момент или в данном регионе пользующихся наибольшим спросом, т.е. выборки с большим количеством связей то имеет смысл использовать графовую БД.

## Задача 2

### Решение

* Данные записываются на все узлы с задержкой до часа (асинхронная запись)

CAP: AP. При задержке по времени отсутствует согласованность (consistency). Доступность (avaliability) выполняется. Система отвечает, но без гарантии совпадения ответов с разных узлов. Устойчивость к разделению (partition tolerance) выполненяется. Отклик каждого узла корректен. 

PACELC: PA-EL. После разделения условие доступности выполненяется PA. Иначе (E) с учетом задерки в час остается только L. 

* При сетевых сбоях, система может разделиться на 2 раздельных кластера

CAP: AP. Аналогично первому случаю.

PACELC: PA-EL. После сетевого сбоя и разделения на два кластера, речи о согласованности не может быть, до момента устранения сбоя. Если мы рассматриваем данные промежуток времени, котороый по условиям задачи не ограничен, то остается только EL. 
    
* Система может не прислать корректный ответ или сбросить соединение

CAP: Совсем не понятное условие задачи. Система может прислать ответ но он будет не корректным? Что означет первая фраза в задании? Отсутствие согласованности при разделении? Вторая часть фразы "сбросить соединение" т.е. иногда система может сбросить соединение и таким образом данное поведение системы мы не можем классифициовать как ответ, только как отсутствие доступности. На каком уровне по модели OSI происходит сброс соединения? На седьмом или на каком? Ответ из подсказки CA но я считаю его не достаточно обоснованным по причине размытой постановки вопроса. Если исходить из подсказки по PACELC, допускается разделении (P), доступности нет, но консистентность есть (C), т.е. по CAP теореме получается CP. Исходя из определения: "база данных CP обеспечивает согласованность и устойчивость к разделению в ущерб доступности. Если возникает разделение между двумя узлами, то система вынуждена завершить работу несогласованного узла (сделать его недоступным) до тех пор, пока разделение не будет устранено.". Вполне себе этот случай.

PACELC: PC-EC.

## Задача 3

### Решение

В соответствии с CAP теоремой ACID требование сочетает CA но исключает разделение P. В BASE сочетается AP, но согласованностью приходиться жертвовать. Возможно состояние в некоторый момент времени при котором будет достигнута согласованность. Таким образом (ACID и BASE) это два взаимоисключающие подхода в реализации СУБД. При проектировании реальных систем они могут сочетаться, т.е. некоторое количество баз данных будут удовлетворять требованиям ACID и некоторое количество (другая чать баз данных) соответствовать BASE.

## Задача 4

### Решение

Да, слышал о key-value хранилище, которое имеет механизм Pub/Sub. Эта система Redis. Из минусов выбора:
1. Данные хранятся в памяти, соответственно должны в ней умещаться;
2. Отсутствует SQL, только команды;
3. Отсутвтует разграничение прав доступа в классическом понимании;
4. В режиме персистентности возникают проблемы с производительлностью, при отключении, в случае сбоя на сервере данные будут потеряны.
